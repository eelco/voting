<html>
    <head>
        <title>Condorcet Voting</title>
        <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js' /></script>
        <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.5.3/jquery-ui.min.js' /></script>
        <script type='text/javascript'>
            $(document).ready(function() {
                $("#list ol").sortable({ connectWith: [ "#stash ul" ] })
                $("#stash ul").sortable({ connectWith: [ "#list ol" ] })
                $("form").bind("submit", function() {
                    var ordered = $("#list ol").sortable('toArray').join();
                    var last    = $("#stash ul").sortable('toArray').join('=');
                    var result  = ordered
                    if (result.length > 0) {
                        if (last.length > 0) result += "," + last
                    } else {
                        result = last;
                    }
                    $("#vote").val(result.replace(/t/g, ''));

                    $.ajax({
                        type: "POST",
                        data: $("form").serialize(),
                        success: function(msg) { alert(msg); window.location.href = "/result" },
                        error:   function(xhr) { alert(xhr.responseText); } 
                    });

                    return false;
                })
            });
        </script>
        <style type='text/css'>
            body { padding: 20px; 
                 ; font-family: Helvetica, Arial, sans-serif;
                 }    
            #stash { background: #ff9
                   ; border:     1px solid #ff3
                   }
            #list { background: #9f9
                  ; border:     1px solid #3f3;
                  ; margin:     10px 0;
                  }
            #list ol { border: 4px solid #9f9; }
        </style>
    </head>
    <body>
        <h1>Condorcet Voting</h1>
        <p>Drag the items from the yellow box onto the green box, and order them.
        Anything you leave in the yellow box when voting will count as equal,
        at the bottom of the list.</p>
        <div id='list'>
            <ol class='sortable'></ol>
        </div>
        <form method='post'>
            <label for='email'>Email address</label>
            <input type='text'   name='email' id='email' value=''>
            <input type='hidden' name='vote' id='vote' value=''/>
            <input type='submit' value='Vote!'/>
        </form>
        <div id='stash'>
            <ul>
                <li id='t1'>Thingie 1</li>
                <li id='t2'>Thingie 2</li>
                <li id='t3'>Thingie 3</li>
                <li id='t4'>Thingie 4</li>
                <li id='t5'>Thingie 5</li>
            </ul>
        </div>
    </body>
</html>
